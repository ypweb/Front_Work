<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0,viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta content="telephone=no" name="format-detection"/>
    <title>会议报名表--tab切换</title>
    <link rel="stylesheet" href="../../resource/css/weui.css">
    <link rel="stylesheet" href="../../resource/css/font.css">
    <link rel="stylesheet" href="../../resource/css/global.css">
    <link rel="stylesheet" href="../../resource/css/base.css">
    <!--require js-->
    <script src="../../resource/js/lib/require/require.js"></script>
    <script>
        /*配置依赖*/
        require.config({
            baseUrl: '/zwwx/',
            paths: {
                "jquery": "resource/js/lib/jquery/jquery.min",
                'touchswipe': "demo/jquery.touchSwipe"
            },
            shim: {
                'touchswipe': {
                    deps: ['jquery']
                }
            }
        });


        /*程序入口*/
        require(['jquery', 'touchswipe'], function ($) {
            $(function () {
                //页面元素获取
                var $tab_btn = $('#tab_btn'),
                    $tab_panel = $('#tab_panel'),
                    $tab_slide = $('#tab_slide'),
                    $title = $tab_slide.prev(),
                    $tab_wrap = $tab_slide.find('>div'),
                    win_width = $(window).width(),
                    item = 3,
                    item_width = Math.ceil(win_width / item),
                    total_width = win_width,
                    parent_class = [
                        'wx-tabpanel-wp1',
                        'wx-tabpanel-wp1half',
                        'wx-tabpanel-wp2',
                        'wx-tabpanel-wp2half',
                        'wx-tabpanel-wp3',
                        'wx-tabpanel-wp3half',
                        'wx-tabpanel-wp4',
                        'wx-tabpanel-wp4half',
                        'wx-tabpanel-wp5',
                        'wx-tabpanel-wp5half',
                        'wx-tabpanel-wp6',
                        'wx-tabpanel-wp6half',
                        'wx-tabpanel-wp7',
                        'wx-tabpanel-wp7half',
                        'wx-tabpanel-wp8',
                        'wx-tabpanel-wp8half',
                        'wx-tabpanel-wp9',
                        'wx-tabpanel-wp9half',
                        'wx-tabpanel-wp10',
                        'wx-tabpanel-wp10half'
                    ],
                    slide_length = $tab_slide.find('a,li').size(),
                    count = 0,
                    cssleft = parseInt($tab_slide.css('left'), 10),
                    tab_class = (function () {
                        var key = 'wx-tablist-item',
                            str = [],
                            i = 1;
                        for (i; i <= 30; i++) {
                            str.push(key + i);
                        }
                        return str.slice();
                    }());


                function tabInit() {
                    if (slide_length > item) {
                        count = Math.ceil(slide_length / item);
                        total_width = win_width * count;
                        $tab_slide.addClass('wx-tabpanel-wp' + count);
                        $tab_wrap.addClass('wx-tablist-item' + (item * count));
                    }
                    /*绑定切换事件*/
                    if (count > 1) {
                        /*绑定swipe事件*/
                        $tab_slide.swipe({
                            swipeLeft: function (event, direction, distance, duration, fingerCount, fingerData) {
                                if (cssleft <= -(total_width - win_width)) {
                                    console.log('left1');
                                    cssleft = -(total_width - win_width);
                                } else {
                                    console.log('left2');
                                    cssleft -= item_width;
                                }
                                $tab_slide.css({
                                    'left': cssleft
                                });
                            },
                            swipeRight: function (event, direction, distance, duration, fingerCount, fingerData) {
                                if (cssleft >= 0) {
                                    console.log('right1');
                                    cssleft = 0;
                                } else {
                                    console.log('right2');
                                    cssleft += item_width;
                                }
                                $tab_slide.css({
                                    'left': cssleft
                                });
                            }
                        });

                    }
                }

                /*执行初始化*/
                tabInit();


                /*事件绑定*/
                $tab_btn.on('click', function () {
                    /*切换菜单模式*/
                    if ($tab_panel.hasClass('wx-tabpanel-column')) {
                        /*横排模式*/
                        $tab_panel.removeClass('wx-tabpanel-column');
                        $tab_slide.addClass('wx-tabpanel-wp' + count);
                        $tab_wrap.addClass('wx-tablist-item' + (item * count));
                        /*开启滑动*/
                        $tab_slide.swipe("enable");
                    } else {
                        /*竖排模式*/
                        cssleft=0;
                        $tab_slide.css({
                            'left':cssleft
                        });
                        $tab_slide.removeClass(parent_class.join(' '));
                        $tab_wrap.removeClass(tab_class.join(' '));
                        $tab_panel.addClass('wx-tabpanel-column');
                        /*取消滑动*/
                        $tab_slide.swipe("disable");
                    }

                });

                /*绑定tap事件*/
                $tab_slide.on('click', function (e) {
                    var target = e.target,
                        nodename = target.nodeName.toLowerCase(),
                        $this = null;


                    /*过滤非标签*/
                    if (nodename === 'ul' || nodename === 'div') {
                        return false;
                    }



                    if (nodename === 'a' || nodename === 'li') {
                        /*切换显示隐藏*/
                        $this = $(target);
                        $this.toggleClass('tabactive').siblings().removeClass('tabactive');
                        if($tab_panel.hasClass('wx-tabpanel-column')){
                            $tab_btn.trigger('click');
                        }
                    }
                });


            });
        });
    </script>
</head>
<body>

<h2 class="wx-theme-wrap">tab切换--多列定宽</h2>

<div class="wx-tabpanel-wrap tabpanel-btnright" id="tab_panel">
    <div class="wx-tabpanel-show">
        <h1>tab切换--多列定宽</h1>
        <div class="wx-tabpanel-slide" id="tab_slide">
            <div class="wx-tablist-wrap">
                <a class="menu-yijian" href="#">意见</a>
                <a class="menu-zhengwen" href="#" class="active">正文</a>
                <a class="menu-ziliao" href="#">参考资料</a>
                <a class="menu-bianqian" href="#">便签贴</a>
                <a class="menu-chengpi" href="#">呈批信息</a>
                <a class="menu-banli" href="#">办理信息</a>
                <a class="menu-genzong" href="#">交换跟踪</a>
                <a class="menu-biaodan" href="#">表单</a>
            </div>
        </div>
    </div>
    <div class="wx-tabpanel-toggle" id="tab_btn"></div>
</div>

<h2 class="wx-theme-wrap">tab切换--自适应</h2>
<div class="wx-tablist-wrap">
    <a href="#" class="active">表单</a>
    <a href="#">正文</a>
    <a href="#">参考资料</a>
</div>

<h2 class="wx-theme-wrap">tab切换--2列定宽</h2>
<div class="wx-tablist-wrap wx-tablist-item2">
    <a href="#" class="active">表单</a>
    <a href="#">正文</a>
</div>

<h2 class="wx-theme-wrap">tab切换--3列定宽</h2>
<div class="wx-tablist-wrap wx-tablist-item3">
    <a href="#">表单</a>
    <a href="#" class="active">正文</a>
    <a href="#">参考资料</a>
</div>

<h2 class="wx-theme-wrap">tab切换--4列定宽</h2>
<div class="wx-tablist-wrap wx-tablist-item4">
    <a href="#">表单</a>
    <a href="#" class="active">正文</a>
    <a href="#">参考资料</a>
    <a href="#">其他</a>
</div>

</body>
</html>